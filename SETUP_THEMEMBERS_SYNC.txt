===============================================================================
                    GUIA DE CONFIGURAÃ‡ÃƒO THEMEMBERS SYNC
                    Antes do Deploy na PythonAnywhere
===============================================================================

ðŸ“‹ CHECKLIST PRÃ‰-DEPLOY:
â–¡ 1. Testar sincronizaÃ§Ã£o localmente
â–¡ 2. Configurar variÃ¡veis de ambiente
â–¡ 3. Preparar script de sincronizaÃ§Ã£o
â–¡ 4. Configurar cron job na PythonAnywhere
â–¡ 5. Testar em produÃ§Ã£o

===============================================================================
PASSO 1: TESTAR SINCRONIZAÃ‡ÃƒO LOCALMENTE
===============================================================================

1.1 - Execute o comando de sincronizaÃ§Ã£o:
```bash
cd backend_passei
python manage.py sync_themembers_products --verbose
```

1.2 - Verifique se funcionou:
- Deve mostrar "âœ… SincronizaÃ§Ã£o concluÃ­da com sucesso!"
- Deve listar os produtos encontrados
- Deve criar registros no banco de dados

1.3 - Teste o endpoint da API:
```bash
# Inicie o servidor
python manage.py runserver 8000

# Teste o endpoint (em outro terminal)
curl http://localhost:8000/api/v1/themembers/products/
```

===============================================================================
PASSO 2: CONFIGURAR VARIÃVEIS DE AMBIENTE
===============================================================================

2.1 - No PythonAnywhere, crie arquivo .env:
```bash
# No diretÃ³rio do projeto na PythonAnywhere
nano .env
```

2.2 - Adicione as configuraÃ§Ãµes:
```env
# TheMembers API Configuration
THEMEMBERS_API_URL=https://registration.themembers.dev.br/api
THEMEMBERS_DEVELOPER_TOKEN=c8ba2c31-3129-40ed-88cb-04e0f305d8d9
THEMEMBERS_DEVELOPER_ID=097493d3-680d-439f-a405-0c50f132582a
THEMEMBERS_PLATFORM_TOKEN=c9012a5e-13c1-48ae-bfa9-584ff4a56c13
THEMEMBERS_PLATFORM_ID=4072

# Outras configuraÃ§Ãµes
DEBUG=False
SECRET_KEY=sua_chave_secreta_aqui
```

2.3 - Instale python-decouple se nÃ£o estiver instalado:
```bash
pip install python-decouple
```

===============================================================================
PASSO 3: PREPARAR SCRIPT DE SINCRONIZAÃ‡ÃƒO
===============================================================================

3.1 - Crie script de sincronizaÃ§Ã£o na PythonAnywhere:
```bash
# No diretÃ³rio do projeto
nano sync_themembers.sh
```

3.2 - ConteÃºdo do script:
```bash
#!/bin/bash

# ConfiguraÃ§Ãµes
PROJECT_DIR="/home/SEU_USUARIO/SEU_PROJETO/backend_passei"
LOG_FILE="/home/SEU_USUARIO/themembers_sync.log"
PYTHON_PATH="/usr/bin/python3.9"

# FunÃ§Ã£o de logging
log() {
    echo "$(date '+%Y-%m-%d %H:%M:%S') - $1" >> "$LOG_FILE"
}

# Verificar se o diretÃ³rio existe
if [ ! -d "$PROJECT_DIR" ]; then
    log "ERRO: DiretÃ³rio nÃ£o encontrado: $PROJECT_DIR"
    exit 1
fi

# Navegar para o diretÃ³rio
cd "$PROJECT_DIR" || {
    log "ERRO: NÃ£o foi possÃ­vel navegar para o diretÃ³rio"
    exit 1
}

# Ativar ambiente virtual (se usado)
if [ -d "venv" ]; then
    source venv/bin/activate
    log "Ambiente virtual ativado"
fi

# Executar sincronizaÃ§Ã£o
log "Iniciando sincronizaÃ§Ã£o TheMembers..."
$PYTHON_PATH manage.py sync_themembers_products --silent --log-file "$LOG_FILE"

# Verificar resultado
if [ $? -eq 0 ]; then
    log "SincronizaÃ§Ã£o concluÃ­da com sucesso"
else
    log "ERRO: Falha na sincronizaÃ§Ã£o"
fi

# Desativar ambiente virtual
if [ -n "$VIRTUAL_ENV" ]; then
    deactivate
    log "Ambiente virtual desativado"
fi
```

3.3 - Torne o script executÃ¡vel:
```bash
chmod +x sync_themembers.sh
```

3.4 - Teste o script manualmente:
```bash
./sync_themembers.sh
```

===============================================================================
PASSO 4: CONFIGURAR CRON JOB NA PYTHONANYWHERE
===============================================================================

4.1 - Acesse o painel da PythonAnywhere:
- VÃ¡ para https://www.pythonanywhere.com/user/SEU_USUARIO/
- Clique em "Tasks" no menu lateral

4.2 - Configure a tarefa cron:
```bash
# Comando para executar diariamente Ã s 6h da manhÃ£
0 6 * * * /home/SEU_USUARIO/SEU_PROJETO/backend_passei/sync_themembers.sh

# OU para executar a cada 4 horas
0 */4 * * * /home/SEU_USUARIO/SEU_PROJETO/backend_passei/sync_themembers.sh

# OU para executar a cada 2 horas
0 */2 * * * /home/SEU_USUARIO/SEU_PROJETO/backend_passei/sync_themembers.sh
```

4.3 - Exemplo prÃ¡tico:
```bash
# Se seu usuÃ¡rio Ã© "lucas" e projeto estÃ¡ em "backup-passei"
0 6 * * * /home/lucas/backup-passei/backend_passei/sync_themembers.sh
```

===============================================================================
PASSO 5: TESTAR EM PRODUÃ‡ÃƒO
===============================================================================

5.1 - Execute sincronizaÃ§Ã£o manual na primeira vez:
```bash
# No console da PythonAnywhere
cd /home/SEU_USUARIO/SEU_PROJETO/backend_passei
python manage.py sync_themembers_products --verbose
```

5.2 - Verifique os logs:
```bash
# Verificar log da sincronizaÃ§Ã£o
tail -f /home/SEU_USUARIO/themembers_sync.log

# Verificar logs do Django
tail -f /var/log/SEU_USUARIO/SEU_PROJETO.log
```

5.3 - Teste o endpoint da API:
```bash
# Teste se a API estÃ¡ funcionando
curl https://SEU_USUARIO.pythonanywhere.com/api/v1/themembers/products/
```

5.4 - Verifique no admin Django:
- Acesse o admin Django
- VÃ¡ para "TheMembers" > "Produtos TheMembers"
- Confirme que os produtos foram sincronizados

===============================================================================
MONITORAMENTO E MANUTENÃ‡ÃƒO
===============================================================================

6.1 - Verificar se estÃ¡ funcionando:
```bash
# Verificar Ãºltimo sync
python manage.py shell
>>> from themembers.models import TheMembersSyncLog
>>> TheMembersSyncLog.objects.last()

# Verificar produtos sincronizados
>>> from themembers.models import TheMembersProduct
>>> TheMembersProduct.objects.count()
```

6.2 - Logs importantes:
- `/home/SEU_USUARIO/themembers_sync.log` - Log da sincronizaÃ§Ã£o
- `/var/log/SEU_USUARIO/SEU_PROJETO.log` - Log geral da aplicaÃ§Ã£o

6.3 - Comandos Ãºteis:
```bash
# SincronizaÃ§Ã£o manual
python manage.py sync_themembers_products --verbose

# SincronizaÃ§Ã£o silenciosa
python manage.py sync_themembers_products --silent

# Ver produtos disponÃ­veis
python manage.py shell
>>> from themembers.services import CourseSyncService
>>> sync = CourseSyncService()
>>> sync.get_available_products().count()
```

===============================================================================
TROUBLESHOOTING
===============================================================================

âŒ PROBLEMA: "ModuleNotFoundError: No module named 'drf_spectacular'"
âœ… SOLUÃ‡ÃƒO: Instale as dependÃªncias
```bash
pip install -r requirements.txt
```

âŒ PROBLEMA: "Permission denied" no script
âœ… SOLUÃ‡ÃƒO: Torne executÃ¡vel
```bash
chmod +x sync_themembers.sh
```

âŒ PROBLEMA: Cron nÃ£o executa
âœ… SOLUÃ‡ÃƒO: Verifique o caminho e permissÃµes
```bash
# Teste o comando manualmente primeiro
/home/SEU_USUARIO/SEU_PROJETO/backend_passei/sync_themembers.sh
```

âŒ PROBLEMA: API nÃ£o responde
âœ… SOLUÃ‡ÃƒO: Verifique se o servidor estÃ¡ rodando
```bash
# Reinicie o servidor web na PythonAnywhere
# VÃ¡ para "Web" > "Reload"
```

===============================================================================
CONFIGURAÃ‡Ã•ES FINAIS
===============================================================================

7.1 - FrequÃªncia recomendada:
- Desenvolvimento: Manual ou a cada 4 horas
- ProduÃ§Ã£o: DiÃ¡rio Ã s 6h da manhÃ£
- Alta demanda: A cada 2-4 horas

7.2 - Backup dos dados:
```bash
# Backup dos produtos sincronizados
python manage.py dumpdata themembers.TheMembersProduct > themembers_products_backup.json
```

7.3 - Alertas (opcional):
- Configure email de notificaÃ§Ã£o para falhas
- Monitore os logs regularmente
- Verifique se novos produtos estÃ£o sendo sincronizados

===============================================================================
RESUMO FINAL
===============================================================================

âœ… CONFIGURAÃ‡ÃƒO COMPLETA:
1. SincronizaÃ§Ã£o testada localmente
2. VariÃ¡veis de ambiente configuradas
3. Script de sincronizaÃ§Ã£o criado
4. Cron job configurado
5. Testado em produÃ§Ã£o

ðŸŽ¯ RESULTADO:
- Produtos TheMembers sincronizados automaticamente
- Logs de monitoramento disponÃ­veis
- SincronizaÃ§Ã£o manual disponÃ­vel via comando
- Endpoint da API funcionando

ðŸš€ PRÃ“XIMOS PASSOS:
1. Fazer deploy da aplicaÃ§Ã£o
2. Monitorar logs por alguns dias
3. Ajustar frequÃªncia se necessÃ¡rio
4. Configurar alertas (opcional)

===============================================================================
CONTATOS E SUPORTE
===============================================================================

ðŸ“§ Em caso de problemas:
- Verifique os logs primeiro
- Teste comandos manualmente
- Consulte a documentaÃ§Ã£o do TheMembers
- Verifique configuraÃ§Ãµes da PythonAnywhere

ðŸ”— Links Ãºteis:
- PythonAnywhere: https://www.pythonanywhere.com/
- TheMembers API: https://documentation.themembers.dev.br/
- Django Docs: https://docs.djangoproject.com/

===============================================================================
